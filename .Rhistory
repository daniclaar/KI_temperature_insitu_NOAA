#################################
# Use region of overlap November 09 2015 to November 09 2016
sst_insitu_region_s2 <- sst_insitu_region[c(1774:2140),]
# Choose what to compare (all in situ and all satellite SST)
graphs3 <- sst_insitu_region_s2[,c(2:10)]
# Run correlationTable
corr3 = correlationTable(graphs3)
colnames(corr3) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)","Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)")
rownames(corr3) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)")
pdf(file = "figures/corr_plot_2015to2016_noNorthShoreI.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr3, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.8,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
pch.col="darkgray",pch.cex=3)
dev.off()
# Clear working environment
rm(list=ls())
# Load necessary packages
library(corrplot)
# Load necessary data
load("data/KI_SB_temp_1d.RData")
load("data/NOAA_CoralTemp_2011_2018.RData")
# Exploratory correlations
corr <- ccf(sst_region$sst_BOW,sst_region$sst_vaskess)
corr <- ccf(bayofwrecks_1d$temperature_1d,sst_BOW$sst,na.action=na.exclude,lag.max = 730)
corr <- ccf(northlagoon_1d$temperature_1d,sst_northlagoon$sst,na.action=na.exclude,lag.max = 730)
corr <- ccf(southlagoon_1d$temperature_1d,sst_southlagoon$sst,na.action=na.exclude,lag.max = 30)
corr <- ccf(vaskesbay_1d$temperature_1d,sst_vaskess$sst,na.action=na.exclude,lag.max = 30)
corr <- ccf(vaskesbay_1d$temperature_1d,northshore_1d$temperature_1d,na.action=na.exclude,lag.max = 30)
# corr <- ccf(vaskesbay_1d$temperature_1d[c(1774:2140)],sst_vaskess$sst[c(1774:2140)],na.action=na.pass,lag.max = 30)
corr$lag[which.max(corr$acf)]
plot(corr,ylim=c(0.7,1),main="Vaskess Bay")
#https://anomaly.io/detect-correlation-time-series/
correlationTable = function(graphs) {
cross = matrix(nrow = length(graphs), ncol = length(graphs))
for(graph1Id in 1:length(graphs)){
graph1 = graphs[[graph1Id]]
print(graph1Id)
for(graph2Id in 1:length(graphs)) {
graph2 = graphs[[graph2Id]]
correlation = ccf(graph1, graph2, lag.max = 0,na.action = na.exclude)
# correlation = ccf(graph1, graph2, lag.max = 0)
cross[graph1Id, graph2Id] = correlation$acf[1]
}
}
cross
}
sst_insitu_region <- cbind(sst_region[c(1:2192),],
"insitu_BOW" = bayofwrecks_1d$temperature_1d,
"insitu_northlagoon" = northlagoon_1d$temperature_1d,
"insitu_southlagoon" = southlagoon_1d$temperature_1d,
"insitu_vaskess" = vaskesbay_1d$temperature_1d,
"insitu_northshore" = northshore_1d$temperature_1d)
# Choose what to compare (all in situ and all satellite SST)
graphs <- sst_insitu_region[,c(2:11)]
# Run correlationTable
corr = correlationTable(graphs)
# colnames(corr) <- names(sst_insitu_region[2:11])
# rownames(corr) <- names(sst_insitu_region[2:11])
colnames(corr) <- c("Bay of Wrecks (S)", "North Lagoon (S)", "South Lagoon (S)",
"Vaskess Bay (S)", "North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)","North Shore (I)")
rownames(corr) <- c("Bay of Wrecks (S)", "North Lagoon (S)", "South Lagoon (S)",
"Vaskess Bay (S)", "North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)","North Shore (I)")
# Removed - insufficient overlap between these two sites - only 62 days
vaskess_northshore_overlap <- sst_insitu_region[which(sst_insitu_region$insitu_northshore!="NaN" & sst_insitu_region$insitu_vaskess!="NaN"),]
plot(vaskess_northshore_overlap$date,vaskess_northshore_overlap$insitu_northshore)
nrow(vaskess_northshore_overlap)
# Use simulated p-value matrix: can be used to cross out certain values in the correlation matrix
p <- matrix(0.05,10,10)
p[9,10] <- 1
p[10,9] <- 1
# Create pdf of correlation plot
pdf(file = "figures/corr_plot.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.75,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
p.mat=p,sig.level=0.05,pch.col="darkgray",pch.cex=3)
dev.off()
#################################
# Use region of overlap August 27 2011 to July 30 2013
sst_insitu_region_s1 <- sst_insitu_region[c(239:942),]
# Choose what to compare (all in situ and all satellite SST)
graphs2 <- sst_insitu_region_s1[,c(2:9,11)]
# Run correlationTable
corr2 = correlationTable(graphs2)
colnames(corr2) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"North Shore (I)")
rownames(corr2) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"North Shore (I)")
pdf(file = "figures/corr_plot_2011to2013_noVaskessI.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr2, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.75,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
pch.col="darkgray",pch.cex=3)
dev.off()
#################################
# Use region of overlap November 09 2015 to November 09 2016
sst_insitu_region_s2 <- sst_insitu_region[c(1774:2140),]
# Choose what to compare (all in situ and all satellite SST)
graphs3 <- sst_insitu_region_s2[,c(2:10)]
# Run correlationTable
corr3 = correlationTable(graphs3)
colnames(corr3) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)","Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)")
rownames(corr3) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)")
pdf(file = "figures/corr_plot_2015to2016_noNorthShoreI.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr3, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.75,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
pch.col="darkgray",pch.cex=3)
dev.off()
# Clear working environment
rm(list=ls())
# Load necessary packages
library(corrplot)
# Load necessary data
load("data/KI_SB_temp_1d.RData")
load("data/NOAA_CoralTemp_2011_2018.RData")
# Exploratory correlations
corr <- ccf(sst_region$sst_BOW,sst_region$sst_vaskess)
corr <- ccf(bayofwrecks_1d$temperature_1d,sst_BOW$sst,na.action=na.exclude,lag.max = 730)
corr <- ccf(northlagoon_1d$temperature_1d,sst_northlagoon$sst,na.action=na.exclude,lag.max = 730)
corr <- ccf(southlagoon_1d$temperature_1d,sst_southlagoon$sst,na.action=na.exclude,lag.max = 30)
corr <- ccf(vaskesbay_1d$temperature_1d,sst_vaskess$sst,na.action=na.exclude,lag.max = 30)
corr <- ccf(vaskesbay_1d$temperature_1d,northshore_1d$temperature_1d,na.action=na.exclude,lag.max = 30)
# corr <- ccf(vaskesbay_1d$temperature_1d[c(1774:2140)],sst_vaskess$sst[c(1774:2140)],na.action=na.pass,lag.max = 30)
corr$lag[which.max(corr$acf)]
plot(corr,ylim=c(0.7,1),main="Vaskess Bay")
#https://anomaly.io/detect-correlation-time-series/
correlationTable = function(graphs) {
cross = matrix(nrow = length(graphs), ncol = length(graphs))
for(graph1Id in 1:length(graphs)){
graph1 = graphs[[graph1Id]]
print(graph1Id)
for(graph2Id in 1:length(graphs)) {
graph2 = graphs[[graph2Id]]
correlation = ccf(graph1, graph2, lag.max = 0,na.action = na.exclude)
# correlation = ccf(graph1, graph2, lag.max = 0)
cross[graph1Id, graph2Id] = correlation$acf[1]
}
}
cross
}
sst_insitu_region <- cbind(sst_region[c(1:2192),],
"insitu_BOW" = bayofwrecks_1d$temperature_1d,
"insitu_northlagoon" = northlagoon_1d$temperature_1d,
"insitu_southlagoon" = southlagoon_1d$temperature_1d,
"insitu_vaskess" = vaskesbay_1d$temperature_1d,
"insitu_northshore" = northshore_1d$temperature_1d)
# Choose what to compare (all in situ and all satellite SST)
graphs <- sst_insitu_region[,c(2:11)]
# Run correlationTable
corr = correlationTable(graphs)
# colnames(corr) <- names(sst_insitu_region[2:11])
# rownames(corr) <- names(sst_insitu_region[2:11])
colnames(corr) <- c("Bay of Wrecks (S)", "North Lagoon (S)", "South Lagoon (S)",
"Vaskess Bay (S)", "North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)","North Shore (I)")
rownames(corr) <- c("Bay of Wrecks (S)", "North Lagoon (S)", "South Lagoon (S)",
"Vaskess Bay (S)", "North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)","North Shore (I)")
# Removed - insufficient overlap between these two sites - only 62 days
vaskess_northshore_overlap <- sst_insitu_region[which(sst_insitu_region$insitu_northshore!="NaN" & sst_insitu_region$insitu_vaskess!="NaN"),]
plot(vaskess_northshore_overlap$date,vaskess_northshore_overlap$insitu_northshore)
nrow(vaskess_northshore_overlap)
# Use simulated p-value matrix: can be used to cross out certain values in the correlation matrix
p <- matrix(0.05,10,10)
p[9,10] <- 1
p[10,9] <- 1
# Create pdf of correlation plot
pdf(file = "figures/corr_plot.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.75,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
p.mat=p,sig.level=0.05,pch.col="darkgray",pch.cex=3)
dev.off()
#################################
# Use region of overlap August 27 2011 to July 30 2013
sst_insitu_region_s1 <- sst_insitu_region[c(239:942),]
# Choose what to compare (all in situ and all satellite SST)
graphs2 <- sst_insitu_region_s1[,c(2:9,11)]
# Run correlationTable
corr2 = correlationTable(graphs2)
colnames(corr2) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"North Shore (I)")
rownames(corr2) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"North Shore (I)")
pdf(file = "figures/corr_plot_2011to2013_noVaskessI.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr2, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.75,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
pch.col="darkgray",pch.cex=3)
dev.off()
#################################
# Use region of overlap November 09 2015 to November 09 2016
sst_insitu_region_s2 <- sst_insitu_region[c(1774:2140),]
# Choose what to compare (all in situ and all satellite SST)
graphs3 <- sst_insitu_region_s2[,c(2:10)]
# Run correlationTable
corr3 = correlationTable(graphs3)
colnames(corr3) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)","Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)")
rownames(corr3) <- c("Bay of Wrecks (S)", "North Lagoon (S)",
"South Lagoon (S)", "Vaskess Bay (S)",
"North Shore (S)","Bay of Wrecks (I)",
"North Lagoon (I)", "South Lagoon (I)",
"Vaskess Bay (I)")
pdf(file = "figures/corr_plot_2015to2016_noNorthShoreI.pdf",width=8,height=7,useDingbats = FALSE)
corrplot.mixed(corr3, upper = "circle",
lower.col = colorRampPalette(c("blue","yellow", "red"))(20),
number.cex = 0.85,tl.pos = "lt",
number.digits=3, cl.lim = c(0.75,1),is.corr = FALSE,
upper.col = colorRampPalette(c("blue","yellow", "red"))(20),
tl.col="black",tl.srt=45,outline="darkgray",
pch.col="darkgray",pch.cex=3)
dev.off()
# Clear working environment
rm(list=ls())
# Load necessary packages
library(ggplot2)
# Load necessary data
load("data/KI_SB_temp_1d.RData")
load("data/NOAA_CoralTemp_2011_2018.RData")
plot_temps <- function(insitu,satellite){
ggplot()+ theme_classic()+theme(legend.position = c(0.075, 0.87))+
geom_line(aes(x=xi3,y=temperature_1d, color="In situ"),
data=insitu)+
geom_line(aes(x=date,y=sst, color="Satellite"),data=satellite)+
scale_color_manual(name=NULL, values = c("gray50","turquoise"))+
scale_x_datetime(name="Date", expand=c(0,0))+
scale_y_continuous(name="Temperature (°C)")+
NULL
}
plot_temps(bayofwrecks_1d,sst_BOW)
plot_temps(northlagoon_1d,sst_northlagoon)
plot_temps(northshore_1d,sst_northshore)
plot_temps(vaskesbay_1d,sst_vaskess)
plot_temps(southlagoon_1d,sst_southlagoon)
BOW <- plot_temps(bayofwrecks_1d,sst_BOW)+guides(color=FALSE)+
annotate("text",x=as.POSIXct("2018/1/1 00:00:00",format="%Y/%m/%d %H:%M:%S",
tz="Pacific/Kiritimati"),
y=30.5, label="Bay of Wrecks")
NL <- plot_temps(northlagoon_1d,sst_northlagoon)+guides(color=FALSE)+
annotate("text",x=as.POSIXct("2018/1/1 00:00:00",format="%Y/%m/%d %H:%M:%S",
tz="Pacific/Kiritimati"),
y=30.5, label="North Lagoon")
NS <- plot_temps(northshore_1d,sst_northshore)+guides(color=FALSE)+
annotate("text",x=as.POSIXct("2018/1/1 00:00:00",format="%Y/%m/%d %H:%M:%S",
tz="Pacific/Kiritimati"),
y=30.5, label="North Shore")
VB <- plot_temps(vaskesbay_1d,sst_vaskess)+
annotate("text",x=as.POSIXct("2018/1/1 00:00:00",format="%Y/%m/%d %H:%M:%S",
tz="Pacific/Kiritimati"),
y=30.5, label="Vaskess Bay")
SL <- plot_temps(southlagoon_1d,sst_southlagoon)+guides(color=FALSE)+
annotate("text",x=as.POSIXct("2018/1/1 00:00:00",format="%Y/%m/%d %H:%M:%S",
tz="Pacific/Kiritimati"),
y=30.5, label="South Lagoon")
pdf(file = "figures/KI_insitu_satellite_temps.pdf", width = 7.5, height = 10, useDingbats = FALSE)
grid.arrange(VB,SL,NL,NS,BOW, nrow=5)
dev.off()
# Load necessary packages
library(ncdf4)
library(chron)
library(lattice)
library(RColorBrewer)
require(svMisc)
# Clear the working environment
rm(list=ls())
latlon <- read.csv("data/temperature/region_latlons.csv")
latlon <- read.csv("data/region_latlons.csv")
#Need to check if this works
nc <- nc_open("data/NOAA_DHW_3.1/ct5km_dhw_v3.1_20110101.nc")
dhw_full <- ncvar_get( nc, "CRW_DHW")
nc
ncvar_get(nc)
ncdim(nc)
nc$id
nc$var
dhw_full <- ncvar_get( nc, "degree_heating_week")
# get longitude and latitude
lon <- ncvar_get(nc,"lon")
nlon <- dim(lon)
head(lon)
lat <- ncvar_get(nc,"lat")
nlat <- dim(lat)
head(lat)
nc_close(nc)
rm(dhw_full)
latlon
# Load necessary packages
library(ncdf4)
library(chron)
library(lattice)
library(RColorBrewer)
require(svMisc)
# Clear the working environment
rm(list=ls())
latlon <- read.csv("data/region_latlons.csv")
files=list.files("data/NOAA_DHW_3.1/",full.names = TRUE)
2922/365
#Testing: Need to check if this works
nc <- nc_open("data/NOAA_DHW_3.1/ct5km_dhw_v3.1_20110101.nc")
dhw_full <- ncvar_get( nc, "degree_heating_week")
# get longitude and latitude
lon <- ncvar_get(nc,"lon")
nlon <- dim(lon)
head(lon)
lat <- ncvar_get(nc,"lat")
nlat <- dim(lat)
head(lat)
nc_close(nc)
rm(dhw_full,lon,nlon,lat,nlat)
LonIdx <- 452 # Northshore -157.45
LatIdx <- 1760 # Northshore 2.025
dhwlist <- list()
for (i in files) {
# Open the netcdf file
nc <- nc_open(i)
dhwlist[[i]] <- ncvar_get( nc, "degree_heating_week")[LonIdx, LatIdx]
# Close the netcdf file --!!IMPORTANT!! otherwise you might corrupt your netcfd file
nc_close(nc)
print(i)
Sys.sleep(0.01)
flush.console()
}
dhw <- do.call(rbind, dhwlist)
dhw_northshore <- data.frame(dhw)
colnames(dhw_northshore) <- c("id","dhw")
colnames(dhw_northshore)
dhw_northshore$date <- rownames(dhw_northshore)
dhw_northshore$date
dhw_northshore$date <- gsub(x = dhw_northshore$date,pattern="data/NOAA_DHW_3.1/ct5km_dhw_v3.1_",replacement = "")
dhw_northshore$date <- gsub(x = dhw_northshore$date,pattern=".nc",replacement = "")
dhw_northshore$date <- as.POSIXct(dhw_northshore$date,format="%Y%m%d")
head(dhw_northshore)
dhw_northshore_max <- max(dhw_northshore$dhw)
dhw_northshore[which(dhw_northshore$dhw==max(dhw_northshore$dhw)),]
#Testing: Need to check if this works
nc <- nc_open("data/NOAA_DHW_3.1/ct5km_dhw_v3.1_20110101.nc")
dhw_full <- ncvar_get( nc, "degree_heating_week")
# get longitude and latitude
lon <- ncvar_get(nc,"lon")
nlon <- dim(lon)
head(lon)
lat <- ncvar_get(nc,"lat")
nlat <- dim(lat)
head(lat)
nc_close(nc)
lon[452]
lat[1760]
LonIdx <- 451 # VaskessBay -157.5
LatIdx <- 1764 # VaskessBay 1.85
dhwlist <- list()
for (i in files) {
# Open the netcdf file
nc <- nc_open(i)
dhwlist[[i]] <- ncvar_get( nc, "degree_heating_week")[LonIdx, LatIdx]
# Close the netcdf file --!!IMPORTANT!! otherwise you might corrupt your netcfd file
nc_close(nc)
print(i)
Sys.sleep(0.01)
flush.console()
}
dhw <- do.call(rbind, dhwlist)
dhw_vaskess <- data.frame(dhw)
dhw_vaskess$date <- rownames(dhw_vaskess)
dhw_vaskess$date <- gsub(x = dhw_vaskess$date,pattern="data/NOAA_DHW_3.1/ct5km_dhw_v3.1_",replacement = "")
dhw_vaskess$date <- gsub(x = dhw_vaskess$date,pattern=".nc",replacement = "")
dhw_vaskess$date <- as.POSIXct(dhw_vaskess$date,format="%Y%m%d")
dhw_vaskess_max <- max(dhw_vaskess$dhw)
dhw_vaskess[which(dhw_vaskess$dhw==max(dhw_vaskess$dhw)),]
LonIdx <- 449 # SouthLagoon -157.55
LatIdx <- 1762 # SouthLagoon 1.9
dhwlist <- list()
for (i in files) {
# Open the netcdf file
nc <- nc_open(i)
dhwlist[[i]] <- ncvar_get( nc, "degree_heating_week")[LonIdx, LatIdx]
# Close the netcdf file --!!IMPORTANT!! otherwise you might corrupt your netcfd file
nc_close(nc)
print(i)
Sys.sleep(0.01)
flush.console()
}
dhw <- do.call(rbind, dhwlist)
dhw_southlagoon <- data.frame(dhw)
dhw_southlagoon$date <- rownames(dhw_southlagoon)
dhw_southlagoon$date <- gsub(x = dhw_southlagoon$date,pattern="data/NOAA_DHW_3.1/ct5km_dhw_v3.1_",replacement = "")
dhw_southlagoon$date <- gsub(x = dhw_southlagoon$date,pattern=".nc",replacement = "")
dhw_southlagoon$date <- as.POSIXct(dhw_southlagoon$date,format="%Y%m%d")
dhw_southlagoon_max <- max(dhw_southlagoon$dhw)
dhw_southlagoon[which(dhw_southlagoon$dhw==max(dhw_southlagoon$dhw)),]
head(dhw_southlagoon)
plot(dhw_southlagoon)
plot(dhw_southlagoon$date,dhw_southlagoon$dhw)
LonIdx <- 454 # BayofWrecks -157.3
LatIdx <- 1764 # BayofWrecks 1.8
dhwlist <- list()
for (i in files) {
# Open the netcdf file
nc <- nc_open(i)
dhwlist[[i]] <- ncvar_get( nc, "degree_heating_week")[LonIdx, LatIdx]
# Close the netcdf file --!!IMPORTANT!! otherwise you might corrupt your netcfd file
nc_close(nc)
print(i)
Sys.sleep(0.01)
flush.console()
}
dhw <- do.call(rbind, dhwlist)
dhw_BOW <- data.frame(dhw)
dhw_BOW$date <- rownames(dhw_BOW)
dhw_BOW$date <- gsub(x = dhw_BOW$date,pattern="data/NOAA_DHW_3.1/ct5km_dhw_v3.1_",replacement = "")
dhw_BOW$date <- gsub(x = dhw_BOW$date,pattern=".nc",replacement = "")
dhw_BOW$date <- as.POSIXct(dhw_BOW$date,format="%Y%m%d")
dhw_BOW_max <- max(dhw_BOW$dhw)
dhw_BOW[which(dhw_BOW$dhw==max(dhw_BOW$dhw)),]
LonIdx <- 451 # NorthLagoon -157.5
LatIdx <- 1760 # NorthLagoon 2.0
dhwlist <- list()
for (i in files) {
# Open the netcdf file
nc <- nc_open(i)
dhwlist[[i]] <- ncvar_get( nc, "degree_heating_week")[LonIdx, LatIdx]
# Close the netcdf file --!!IMPORTANT!! otherwise you might corrupt your netcfd file
nc_close(nc)
print(i)
Sys.sleep(0.01)
flush.console()
}
dhw <- do.call(rbind, dhwlist)
dhw_northlagoon <- data.frame(dhw)
dhw_northlagoon$date <- rownames(dhw_northlagoon)
dhw_northlagoon$date <- gsub(x = dhw_northlagoon$date,pattern="data/NOAA_DHW_3.1/ct5km_dhw_v3.1_",replacement = "")
dhw_northlagoon$date <- gsub(x = dhw_northlagoon$date,pattern=".nc",replacement = "")
dhw_northlagoon$date <- as.POSIXct(dhw_northlagoon$date,format="%Y%m%d")
dhw_northlagoon_max <- max(dhw_northlagoon$dhw)
dhw_northlagoon[which(dhw_northlagoon$dhw==max(dhw_northlagoon$dhw)),]
dhw_dist <- merge(dhw_northshore,dhw_vaskess, by="date",
suffixes = c("_northshore","_vaskess"))
dhw_region <- merge(dhw_northshore,dhw_vaskess, by="date",
suffixes = c("_northshore","_vaskess"))
rm(dhw_dist)
head(dhw_region)
dhw_region <- merge(dhw_region, dhw_southlagoon, by="date")
colnames(dhw_region)[4] <- "dhw_southlagoon"
dhw_region <- merge(dhw_region, dhw_northlagoon, by="date")
colnames(dhw_region)[5] <- "dhw_northlagoon"
dhw_region <- merge(dhw_region, dhw_BOW, by="date")
colnames(dhw_region)[6] <- "dhw_BOW"
head(dhw_region)
save.image(file="data/NOAA_DHW_5km.RData")
rm(dhw_full)
head(dhwlist)
nc
rm(dhw,dhw_full,nc,dhwlist,nc,i,lat,lon,LatIdx,LonIdx,nlat,nlon)
#Save RData file for downstream use
save.image(file="data/NOAA_DHW_5km.RData")
